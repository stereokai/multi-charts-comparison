import{g as E,c,a as I,G as T,u as H,b as X}from"./echarts.renderer.884f2cdc.js";import{l as o}from"./vendor.b30e4d30.js";function P(h=new Date){return h.setDate(h.getDate()-1),h.setHours(22)}const M=h=>class f extends h{static CHART_LEFT_PADDING=100;get CHART_LEFT_PADDING(){return f.CHART_LEFT_PADDING}static Y_AXIS_WIDTH=60;get Y_AXIS_WIDTH(){return f.Y_AXIS_WIDTH}static addChannel(e,t,s,i,n=!1){const r=e.createChartXY({columnIndex:0,rowIndex:s,columnSpan:1,rowSpan:1,disableAnimations:!0}).setTitle("").setPadding({left:f.CHART_LEFT_PADDING,top:0,bottom:0}).setBackgroundStrokeStyle(o.emptyLine).setMouseInteractions(!1).setMouseInteractionPan(!0).setSeriesBackgroundFillStyle(new o.SolidFill({color:o.ColorCSS("white")})),a=r.getDefaultAxisX().setMouseInteractions(!1).setTickStrategy(o.AxisTickStrategies.Empty,g=>console.log(g)).setStrokeStyle(o.emptyLine),l=E(t),d=r.getDefaultAxisY().setMouseInteractions(!1).setChartInteractions(!1).setStrokeStyle(o.emptyLine).setTitle(t.name).setInterval(l.min,l.max).setTitleFont(new o.FontSettings({size:12})).setTitleFillStyle(new o.SolidFill({color:o.ColorHEX("#6e7079")})).setTitleRotation(0).setThickness(f.Y_AXIS_WIDTH).setAnimationZoom(void 0).setTickStrategy(o.AxisTickStrategies.Numeric,g=>g.setMajorTickStyle(m=>m.setLabelFillStyle(new o.SolidFill({color:o.ColorHEX("#6e7079")})).setLabelFont(new o.FontSettings({size:6})).setTickStyle(o.emptyLine)).setMinorTickStyle(m=>m.setLabelFont(new o.FontSettings({size:6})).setTickStyle(o.emptyLine)));t.dynamicYAxis||d.setScrollStrategy(void 0);let p;return n||(p=f.addLineSeries(r,typeof i=="number"?i:s)),{chart:r,series:p,xAxis:a,yAxis:d,row:s}}static addLineSeries(e,t=0){return e.addLineSeries({dataPattern:{pattern:"ProgressiveX",regularProgressiveStep:!0,allowDataGrouping:!0},automaticColorIndex:t}).setStrokeStyle(s=>s.setThickness(-1))}addChannel(e,t,s,i){return window.graphs=this.graphs,f.addChannel(this.dashboard,e,t,s,i)}addLineSeries(e,t){return f.addLineSeries(e,t)}};var W=Object.freeze(Object.defineProperty({__proto__:null,default:M},Symbol.toStringTag,{value:"Module"})),v=`<svg id="areazoom-svg" style="position: absolute; z-index: 10000; width: 100%; height: 100%; pointer-events: none;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <!-- <rect id="resize" fill="red" x="190" y="160" width="20" height="20" /> -->
  <rect id="areazoom-rect" fill="rgba(50, 50, 50, 0.5)" />
</svg>`;let u,y;function G(h){h.insertAdjacentHTML("beforeend",v),u=document.getElementById("areazoom-rect")}function A(h){u.setAttribute("height",h)}function w(h){y=h,u.setAttribute("x",h)}function C(h){h>y?u.setAttribute("width",h-y):(u.setAttribute("width",y-h),u.setAttribute("x",h))}function k(){const h=u.getAttribute("x"),S=u.getAttribute("width");return u.setAttribute("width",0),{x:h|0,width:S|0}}var $=Object.freeze(Object.defineProperty({__proto__:null,svg:v,init:G,setHeight:A,setPosition:w,move:C,hide:k},Symbol.toStringTag,{value:"Module"})),q=Object.freeze(Object.defineProperty({__proto__:null,svg:v,init:G,setHeight:A,setPosition:w,move:C,hide:k},Symbol.toStringTag,{value:"Module"}));const D=h=>class x extends h{static visibleGridStyle=new o.SolidLine({thickness:1,fillStyle:new o.SolidFill({color:o.ColorCSS("#dfdfdf")})});static hiddenGridStyle=o.emptyLine;static getNewDashboard(e,t){return o.lightningChart({overrideInteractionMouseButtons:{chartXYPanMouseButton:0,chartXYRectangleZoomFitMouseButton:2}}).Dashboard({container:e,numberOfColumns:1,numberOfRows:t,theme:o.Themes.lightNew}).setBackgroundFillStyle(new o.SolidFill({color:o.ColorCSS("white")})).setSplitterStyle(o.emptyLine).setSplitterStyleHighlight(o.emptyLine)}get maxVisibleCharts(){return super.maxVisibleCharts*2+1}get mainGraph(){return this.graphGroup||super.mainGraph}get dashboardLeftOffset(){return this.CHART_LEFT_PADDING+this.Y_AXIS_WIDTH}constructor(...e){super(...e);this.pinnedGraphs=[]}newDashboard(e,t=this.maxVisibleCharts){this.dashboard=x.getNewDashboard(e,t),G(e)}updateDashboardRowHeights(){const{dashboard:e,graphs:t,pinnedGraphs:s,mainGraph:i,maxVisibleCharts:n}=this,r=t.map((g,m)=>m).filter(g=>!c[g].isHidden);i.isGroup&&r.push(i.graphIndex);const a=s.map(g=>g.pinnedIndex),l=r.concat(a),d=i.xAxis.getHeight(),p=(e.engine.container.clientHeight-d)/l.length;for(let g=0;g<n;g++)l.includes(g)?e.setRowHeight(g,Math.round(p)):e.setRowHeight(g,1e-5);e.setRowHeight(i.row,Math.round(p+d)),window.dashboard=e,A(r.length*p)}setXAxisStyle(){this.graphs.forEach((e,t)=>{e.xAxis.setTickStrategy(o.AxisTickStrategies.Empty)}),this.mainGraph.xAxis.setTickStrategy(o.AxisTickStrategies.DateTime,e=>e.setDateOrigin(new Date(P())).setMajorTickStyle(t=>t.setGridStrokeStyle(o.emptyLine).setTickStyle(o.emptyLine)).setMinorTickStyle(t=>t.setGridStrokeStyle(o.emptyLine).setTickStyle(o.emptyLine)))}syncXAxesZoom(){this.axisSyncHandle&&this.axisSyncHandle.remove();const e=this.graphs.map(t=>t.xAxis);this.mainGraph.isGroup&&e.push(this.mainGraph.xAxis),this.axisSyncHandle=o.synchronizeAxisIntervals(...e)}resetView(){const{mainGraph:e,minX:t,maxX:s}=this;e.xAxis.setInterval(t,s,!1,!0)}toggleGrid(e){this.graphs.forEach(t=>{const s=t.yAxis.getTickStrategy();t.yAxis.setTickStrategy(s,i=>i.setMajorTickStyle(n=>n.setGridStrokeStyle(e?x.visibleGridStyle:x.hiddenGridStyle)))})}toggleChannelVisibility(e,t=!1){const s=this.graphs[e];c[e].isHidden?(s.series.dispose(),s.yAxis.dispose()):(s.series.restore(),s.yAxis.restore()),t||this.updateDashboardRowHeights()}toggleChannelSticky(e,t=!1,s=NaN){const{pinnedGraphs:i,graphs:n}=this,r=n[e],a=c[e];if(a.isSticky){const l=isNaN(s)?i.length&&i[i.length-1].pinnedIndex-1||this.maxVisibleCharts-1:s,d=this.addChannel(a,l,e);d.pinnedIndex=l,i.push(d),d.series.add(r.series.kc[0].La),a.pinnedGraph=d}else{if(!a.pinnedGraph)return;const l=a.pinnedGraph;a.pinnedGraph=null,i.splice(i.indexOf(l),1).forEach(d=>{d.chart.dispose();for(let p in d)d[p]=null})}t||this.updateDashboardRowHeights()}addGraphGroup(){const e=Math.floor(this.maxVisibleCharts/2),t=this.addChannel({name:"Channel Group"},e,null,!0);this.graphGroup=t,t.isGroup=!0,t.graphIndex=e,t.series={},t.repositionYAxis=function(){const{yAxis:i}=this;i.setInterval(...Object.values(this.series).reduce((n,r)=>(n[0]=Math.min(n[0],r.__bounds.min),n[1]=Math.max(n[1],r.__bounds.max),n),[1/0,-1/0]),!1,!0)}.bind(t)}toggleChannelGrouped(e,t=!1){const s=c[e];if(s.isGrouped){this.mainGraph.isGroup||this.addGraphGroup();const{graphs:i,mainGraph:n}=this,r=i[e],a=this.addLineSeries(n.chart,e);a.__bounds=E(s),n.series[e]=a,n.repositionYAxis(),a.add(r.series.kc[0].La)}else{if(!this.mainGraph.isGroup)return;const{mainGraph:i}=this,n=i.series[e];if(!n)return;if(n.dispose(),i.series[e]=null,delete i.series[e],Object.keys(i.series).length===0){i.chart.dispose();for(let r in i)i[r]=null;this.graphGroup=null}else i.repositionYAxis()}t||(this.setXAxisStyle(),this.syncXAxesZoom(),requestAnimationFrame(()=>{this.updateDashboardRowHeights()}))}newMontage(){return c.map((e,t)=>({channelIndex:t,isHidden:e.isHidden,isSticky:e.isSticky,isGrouped:e.isGrouped,pinnedGraphIndex:e.pinnedGraph&&e.pinnedGraph.pinnedIndex}))}loadMontage(e){if(this.pinnedGraphs.splice(0).forEach(t=>{t.chart.dispose();for(let s in t)t[s]=null}),this.mainGraph.isGroup){this.graphGroup.chart.dispose();for(let t in this.mainGraph)this.mainGraph[t]=null;this.graphGroup=null}e.forEach((t,s)=>{c[s].isHidden=t.isHidden,c[s].isSticky=t.isSticky,c[s].isGrouped=t.isGrouped,this.toggleChannelVisibility(s,!0),this.toggleChannelSticky(s,!0,t.pinnedGraphIndex),this.toggleChannelGrouped(s)}),this.updateDashboardRowHeights()}panLeft(){const{xAxis:e,series:t}=this.mainGraph,{minX:s}=this,{start:i,end:n}=e.getInterval(),r=t.scale.x.getPixelSize();let a=(i-n)/4;i+a<s&&(a=s-i),e.pan(a/r)}panRight(){const{xAxis:e,series:t}=this.mainGraph,{maxX:s}=this,{start:i,end:n}=e.getInterval(),r=t.scale.x.getPixelSize();let a=(n-i)/4;n+a>s&&(a=s-n),e.pan(a/r)}};var U=Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"}));const L=h=>class extends h{constructor(...e){super(...e);this.lastEvent=null,this.hasInitialized=!1,this.graphEvents=I()}markEvent(){this.lastEvent={timestamp:performance.now()}}registerZoomEvents(e){e.chart.onSeriesBackgroundMouseWheel((t,s)=>{let{deltaY:i}=s;const{xAxis:n,yAxis:r}=e,{start:a,end:l}=n.getInterval();i=-i;const d=this.getNewInterval(a,l,i);n.setInterval(d.start,d.end,!1,!0)})}getNewInterval(e,t,s,i=1e4){if(i<1e3)return!1;const{minX:n,maxX:r}=this,a=Math.min(r,Math.max(n,e+s*i)),l=Math.max(n,Math.min(r,t-s*i));return a*2>r?this.getNewInterval(e,t,s,i/2):{start:a,end:l}}reportRenderEvent(){requestAnimationFrame(()=>{const e=(performance.now()-this.lastEvent.timestamp)/1e3;this.hasInitialized?this.graphEvents.render({duration:e,type:T.render}):(this.hasInitialized=!0,this.graphEvents.init({duration:e,type:T.init})),this.lastEvent=null})}toggleAreaZoom(e){e?this.graphs.forEach(t=>{const{chart:s}=t;s.setMouseInteractionPan(!1),t.chartEvents={offSeriesBackgroundMouseDragStart:s.onSeriesBackgroundMouseDragStart((i,n,r)=>{r===0&&w(n.offsetX)}),offSeriesBackgroundMouseDrag:s.onSeriesBackgroundMouseDrag((i,n,r)=>{r===0&&C(n.offsetX)}),offSeriesBackgroundMouseDragStop:s.onSeriesBackgroundMouseDragStop((i,n,r)=>{if(r!==0)return;const a=k(),l=i.getSeries()[0].scale.x.getPixelSize(),p=this.mainGraph.xAxis.getInterval().start/l-this.dashboardLeftOffset;this.mainGraph.xAxis.setInterval((p+a.x)*l,(p+a.x+a.width)*l,!1,!0)})}}):this.graphs.forEach(t=>{const{chart:s}=t;for(const[i,n]of Object.entries(t.chartEvents))s[i](n),t.chartEvents[i]=null;s.setMouseInteractionPan(!0)})}};var K=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"}));class _{get minX(){return this.timeSeries[0]}get maxX(){return this.timeSeries[this.timeSeries.length-1]}get mainGraph(){return this.graphs[this.graphs.length-1]}get maxVisibleCharts(){return H.channels.max}constructor(){this.graphs=[]}init(S){this.markEvent(),this.newDashboard(S),S.addEventListener("wheel",e=>{e.preventDefault()},{passive:!1})}update(S=[],e){this.hasInitialized&&this.markEvent(),e&&(this.timeSeries=e);const{graphs:t}=this,s=t.length;this.hasChannelsChanged=!1,S.forEach((i,n)=>{let r=t[n],a=n;c.length!==s&&(this.hasChannelsChanged=!0,a=s+n,t.push(this.addChannel(c[a],a)),r=t[a],this.registerZoomEvents(r)),r.series.clear(),r.series.addArraysXY(e,i.data)}),t.splice(c.length,t.length-c.length).forEach(i=>{this.hasChannelsChanged=!0,i.chart.dispose();for(let n in i)i[n]=null}),this.afterUpdate()}afterUpdate(){(!this.hasInitialized||this.hasChannelsChanged)&&(this.setXAxisStyle(),this.syncXAxesZoom()),requestAnimationFrame(()=>{(!this.hasInitialized||this.hasChannelsChanged)&&this.updateDashboardRowHeights(),this.resetView(),this.reportRenderEvent()})}}var Q=Object.freeze(Object.defineProperty({__proto__:null,default:_},Symbol.toStringTag,{value:"Module"}));class z extends D(M(L(_))){}const b=new z,F=0,j=b.graphEvents;function O(...h){b.init(...h)}function B(...h){b.update(...h)}function N(){}function R(){}const Y=new Proxy(b,X);var ee=Object.freeze(Object.defineProperty({__proto__:null,baseDate:F,graphEvents:j,init:O,update:B,showLoading:N,hideLoading:R,api:Y},Symbol.toStringTag,{value:"Module"}));export{$ as A,ee as L,U as a,K as b,Q as c,P as g,q as i,W as l};
