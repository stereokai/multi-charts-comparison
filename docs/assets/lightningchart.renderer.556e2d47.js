import{g as I,c as p,u as v,d as P,a as z,G as T,b as R}from"./echarts.renderer.ac18396a.js";import{l as a,a as E}from"./vendor.cdc82bdf.js";function V(l=new Date){return l.setDate(l.getDate()-1),l.setHours(22)}const L=l=>class f extends l{static CHART_LEFT_PADDING=100;get CHART_LEFT_PADDING(){return f.CHART_LEFT_PADDING}static Y_AXIS_WIDTH=60;get Y_AXIS_WIDTH(){return f.Y_AXIS_WIDTH}static CHART_GAP=10;get CHART_GAP(){return f.CHART_GAP}static addChannel(e,t,s,i,r=!1){const n=e.createChartXY({columnIndex:0,rowIndex:s,columnSpan:1,rowSpan:1,disableAnimations:!0}).setTitle("").setPadding({left:f.CHART_LEFT_PADDING,top:f.CHART_GAP/2,bottom:f.CHART_GAP/2}).setBackgroundStrokeStyle(a.emptyLine).setMouseInteractions(!1).setMouseInteractionPan(!0).setMouseInteractionRectangleFit(!1).setZoomingRectangleStrokeStyle(new a.SolidLine({thickness:2,fillStyle:new a.SolidFill({color:a.ColorCSS("red")})})).setFittingRectangleStrokeStyle(new a.SolidLine({thickness:2,fillStyle:new a.SolidFill({color:a.ColorCSS("blue")})})).setBackgroundFillStyle(new a.SolidFill({color:a.ColorHEX("#f0f0f0")})).setSeriesBackgroundFillStyle(new a.SolidFill({color:a.ColorCSS("white")})),o=n.getDefaultAxisX().setMouseInteractions(!1).setTickStrategy(a.AxisTickStrategies.Empty,c=>console.log(c)).setStrokeStyle(a.emptyLine),d=I(t),h=n.getDefaultAxisY().setMouseInteractions(!1).setChartInteractions(!1).setStrokeStyle(a.emptyLine).setTitle(t.name).setInterval(d.min,d.max).setTitleFont(new a.FontSettings({size:12})).setTitleFillStyle(new a.SolidFill({color:a.ColorHEX("#6e7079")})).setTitleRotation(0).setThickness(f.Y_AXIS_WIDTH).setAnimationZoom(void 0).setTickStrategy(a.AxisTickStrategies.Numeric,c=>c.setMajorTickStyle(g=>g.setLabelFillStyle(new a.SolidFill({color:a.ColorHEX("#6e7079")})).setLabelFont(new a.FontSettings({size:6})).setTickStyle(a.emptyLine)).setMinorTickStyle(g=>g.setLabelFont(new a.FontSettings({size:6})).setTickStyle(a.emptyLine)));t.dynamicYAxis||h.setScrollStrategy(void 0);let u;return r||(u=f.addLineSeries(n,typeof i=="number"?i:s)),n.setAutoCursorMode(a.AutoCursorModes.disabled),{chart:n,series:u,xAxis:o,yAxis:h,row:s}}static addLineSeries(e,t=0){return e.addLineSeries({dataPattern:{pattern:"ProgressiveX",regularProgressiveStep:!0,allowDataGrouping:!0},automaticColorIndex:t}).setStrokeStyle(s=>s.setThickness(-1))}addChannel(e,t,s,i){window.graphs=this.graphs;const r=f.addChannel(this.dashboard,e,t,s,i),{chart:n,series:o,xAxis:d,yAxis:h,row:u}=r;return n.onSeriesBackgroundMouseClick((c,g)=>{try{const S=o.solveNearestFromScreen(c.engine.clientLocation2Engine(g.clientX,g.clientY)),F=parseFloat(S.resultTableContent[1][1]),B=parseFloat(S.resultTableContent[2][1]);this.addEvent({x:F,y:B},t)}catch(S){console.log(`Could not add event marker, ${S}`)}this.markers.forEach(S=>{S.setResultTableVisibility(a.UIVisibilityModes.never)})}),r}addLineSeries(e,t){return f.addLineSeries(e,t)}};var K=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"})),C=`<svg id="areazoom-svg" style="position: absolute; z-index: 10000; width: 100%; height: 100%; pointer-events: none;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <!-- <rect id="resize" fill="red" x="190" y="160" width="20" height="20" /> -->
  <rect id="areazoom-rect" fill="rgba(50, 50, 50, 0.5)" />
</svg>`;let m,x;function k(l){l.insertAdjacentHTML("beforeend",C),m=document.getElementById("areazoom-rect")}function w(l){m.setAttribute("height",l)}function M(l){x=l,m.setAttribute("x",l)}function G(l){l>x?m.setAttribute("width",l-x):(m.setAttribute("width",x-l),m.setAttribute("x",l))}function D(){const l=m.getAttribute("x"),y=m.getAttribute("width");return m.setAttribute("width",0),{x:l|0,width:y|0}}var Q=Object.freeze(Object.defineProperty({__proto__:null,svg:C,init:k,setHeight:w,setPosition:M,move:G,hide:D},Symbol.toStringTag,{value:"Module"})),ee=Object.freeze(Object.defineProperty({__proto__:null,svg:C,init:k,setHeight:w,setPosition:M,move:G,hide:D},Symbol.toStringTag,{value:"Module"}));E.init();const _=l=>class b extends l{static visibleGridStyle=new a.SolidLine({thickness:1,fillStyle:new a.SolidFill({color:a.ColorCSS("#dfdfdf")})});static hiddenGridStyle=a.emptyLine;static getNewDashboard(e,t){return a.lightningChart({overrideInteractionMouseButtons:{chartXYPanMouseButton:0,chartXYRectangleZoomFitMouseButton:2}}).Dashboard({container:e,numberOfColumns:1,numberOfRows:t,theme:a.Themes.lightNew}).setBackgroundFillStyle(new a.SolidFill({color:a.ColorCSS("white")})).setSplitterStyle(new a.SolidLine({thickness:2,fillStyle:new a.SolidFill({color:a.ColorCSS("black")})})).setSplitterStyleHighlight(new a.SolidLine({thickness:2,fillStyle:new a.SolidFill({color:a.ColorCSS("black")})}))}get maxVisibleCharts(){return super.maxVisibleCharts*2+1}get mainGraph(){return this.graphGroup||super.mainGraph}get dashboardLeftOffset(){return this.CHART_LEFT_PADDING+this.Y_AXIS_WIDTH}constructor(...e){super(...e);this.pinnedGraphs=[],this.markers=[]}newDashboard(e,t=this.maxVisibleCharts){this.dashboard=b.getNewDashboard(e,t),k(e)}updateDashboardRowHeights(){const{dashboard:e,graphs:t,pinnedGraphs:s,mainGraph:i,maxVisibleCharts:r}=this,n=t.map((c,g)=>g).filter(c=>!p[c].isHidden);i.isGroup&&n.push(i.graphIndex);const o=s.map(c=>c.pinnedIndex),d=n.concat(o),h=i.xAxis.getHeight(),u=(e.engine.container.clientHeight-h)/d.length;for(let c=0;c<r;c++)d.includes(c)?e.setRowHeight(c,Math.round(u)):e.setRowHeight(c,1e-5);e.setRowHeight(i.row,Math.round(u+h)),window.dashboard=e,w(n.length*u)}setXAxisStyle(){this.graphs.forEach((e,t)=>{e.xAxis.setTickStrategy(a.AxisTickStrategies.Empty)}),this.mainGraph.xAxis.setTickStrategy(a.AxisTickStrategies.DateTime,e=>e.setDateOrigin(new Date(V())).setMajorTickStyle(t=>t.setGridStrokeStyle(a.emptyLine).setTickStyle(a.emptyLine)).setMinorTickStyle(t=>t.setGridStrokeStyle(a.emptyLine).setTickStyle(a.emptyLine)))}syncXAxesZoom(){this.axisSyncHandle&&this.axisSyncHandle.remove();const e=this.graphs.map(t=>t.xAxis);this.mainGraph.isGroup&&e.push(this.mainGraph.xAxis),this.axisSyncHandle=a.synchronizeAxisIntervals(...e)}resetView(){const{mainGraph:e,minX:t,maxX:s}=this;e.xAxis.setInterval(t,s,!1,!0)}toggleGrid(e){this.graphs.forEach(t=>{const s=t.yAxis.getTickStrategy();t.yAxis.setTickStrategy(s,i=>i.setMajorTickStyle(r=>r.setGridStrokeStyle(e?b.visibleGridStyle:b.hiddenGridStyle)))})}toggleChannelVisibility(e,t=!1){const s=this.graphs[e];p[e].isHidden?(s.series.dispose(),s.yAxis.dispose()):(s.series.restore(),s.yAxis.restore()),t||this.updateDashboardRowHeights()}toggleChannelSticky(e,t=!1,s=NaN){const{pinnedGraphs:i,graphs:r}=this,n=r[e],o=p[e];if(o.isSticky){const d=isNaN(s)?i.length&&i[i.length-1].pinnedIndex-1||this.maxVisibleCharts-1:s,h=this.addChannel(o,d,e);h.pinnedIndex=d,i.push(h),h.series.add(n.series.kc[0].La),o.pinnedGraph=h}else{if(!o.pinnedGraph)return;const d=o.pinnedGraph;o.pinnedGraph=null,i.splice(i.indexOf(d),1).forEach(h=>{h.chart.dispose();for(let u in h)h[u]=null})}t||this.updateDashboardRowHeights()}addGraphGroup(){const e=Math.floor(this.maxVisibleCharts/2),t=this.addChannel({name:"Channel Group"},e,null,!0);this.graphGroup=t,t.isGroup=!0,t.graphIndex=e,t.series={},t.repositionYAxis=function(){const{yAxis:i}=this;i.setInterval(...Object.values(this.series).reduce((r,n)=>(r[0]=Math.min(r[0],n.__bounds.min),r[1]=Math.max(r[1],n.__bounds.max),r),[1/0,-1/0]),!1,!0)}.bind(t)}toggleChannelGrouped(e,t=!1){const s=p[e];if(s.isGrouped){this.mainGraph.isGroup||this.addGraphGroup();const{graphs:i,mainGraph:r}=this,n=i[e],o=this.addLineSeries(r.chart,e);o.__bounds=I(s),r.series[e]=o,r.repositionYAxis(),o.add(n.series.kc[0].La)}else{if(!this.mainGraph.isGroup)return;const{mainGraph:i}=this,r=i.series[e];if(!r)return;if(r.dispose(),i.series[e]=null,delete i.series[e],Object.keys(i.series).length===0){i.chart.dispose();for(let n in i)i[n]=null;this.graphGroup=null}else i.repositionYAxis()}t||(this.setXAxisStyle(),this.syncXAxesZoom(),requestAnimationFrame(()=>{this.updateDashboardRowHeights()}))}newMontage(){return p.map((e,t)=>({channelIndex:t,isHidden:e.isHidden,isSticky:e.isSticky,isGrouped:e.isGrouped,pinnedGraphIndex:e.pinnedGraph&&e.pinnedGraph.pinnedIndex}))}loadMontage(e){if(this.pinnedGraphs.splice(0).forEach(t=>{t.chart.dispose();for(let s in t)t[s]=null}),this.mainGraph.isGroup){this.graphGroup.chart.dispose();for(let t in this.mainGraph)this.mainGraph[t]=null;this.graphGroup=null}e.forEach((t,s)=>{p[s].isHidden=t.isHidden,p[s].isSticky=t.isSticky,p[s].isGrouped=t.isGrouped,this.toggleChannelVisibility(s,!0),this.toggleChannelSticky(s,!0,t.pinnedGraphIndex),this.toggleChannelGrouped(s)}),this.updateDashboardRowHeights()}panLeft(){const{xAxis:e,series:t}=this.mainGraph,{minX:s}=this,{start:i,end:r}=e.getInterval(),n=t.scale.x.getPixelSize();let o=(i-r)/4;i+o<s&&(o=s-i),e.pan(o/n)}panRight(){const{xAxis:e,series:t}=this.mainGraph,{maxX:s}=this,{start:i,end:r}=e.getInterval(),n=t.scale.x.getPixelSize();let o=(r-i)/4;r+o>s&&(o=s-r),e.pan(o/n)}addEvent(e,t){if(!v.extraFeatures.events)return;const s=this.graphs[t],{chart:i,series:r}=s,n=i.addChartMarkerXY(void 0,i.getDefaultAxisX(),i.getDefaultAxisY()).setPosition({x:e.x,y:e.y});this.markers.push(n),n.getPointMarker().setFillStyle(new a.SolidFill({color:a.ColorHEX("#0075ff")})).onMouseClick(()=>{this.markers.forEach(h=>{h.setResultTableVisibility(a.UIVisibilityModes.never)}),n.setResultTableVisibility(a.UIVisibilityModes.always)}),n.getResultTable().onMouseClick(()=>{E.show("modal-1",{onShow:(h,u,c)=>{h.querySelector("textarea").value=n.__content.reduce((g,S)=>g+S.join(" ")+`
`,"")},onClose:(h,u,c)=>{if(c.target.hasAttribute("ok")){n.__content=h.querySelector("textarea").value.trim().split(`
`).map(g=>[g]),n.setResultTable(g=>g.setContent(n.__content));return}if(c.target.hasAttribute("remove")){n.setResultTableVisibility(a.UIVisibilityModes.never),n.dispose(),this.markers.splice(this.markers.indexOf(n),1);return}}})}),n.__content=[["Custom event"],["Number",this.markers.length.toString()]],n.setResultTableVisibility(a.UIVisibilityModes.never).setResultTable(h=>h.setContent(n.__content)).setDraggingMode(a.UIDraggingModes.notDraggable).setGridStrokeXVisibility(a.UIVisibilityModes.whenDragged).setGridStrokeYVisibility(a.UIVisibilityModes.whenDragged).setTickMarkerXVisibility(a.UIVisibilityModes.whenDragged).setTickMarkerYVisibility(a.UIVisibilityModes.whenDragged)}toggleZoomBasedData(){v.extraFeatures.toggleZoomBasedData?P(e=>{this.graphs.forEach(t=>{t.fullData=t.series.kc[0].La.map(s=>s.y),t.fullBoundaries=t.series.getBoundaries(),t.fullInterval=t.yAxis.getInterval(),e({name:"limitArray",data:{dataMin:t.fullBoundaries.minY,dataMax:t.fullBoundaries.maxY,channelData:t.fullData,limitFactor:.2}})})}).then(e=>{e.forEach((s,i)=>{this.graphs[i].limitedData=s.data,this.graphs[i].limitedDataMin=s.dataMin,this.graphs[i].limitedDataMax=s.dataMax});const t=this.mainGraph.xAxis.getInterval();this.zoomBasedDataHandler.call(this,t.start,t.end),this.zoomBasedDataCB=this.graphs[0].xAxis.onScaleChange(this.zoomBasedDataHandler.bind(this))}):(this.graphs[0].yAxis.offScaleChange(this.zoomBasedDataCB),this.zoomBasedDataHandler(0,0),this.graphs.forEach(e=>{e.fullData=null,e.fullBoundaries=null,e.fullInterval=null,e.limitedData=null,e.limitedDataMin=null,e.limitedDataMax=null}))}zoomBasedDataHandler(e,t){if(!this.isShowingLimitedZoomBasedData&&Math.abs(t-e)>this.maxX/3){const s=document.querySelector("#label-zoom-based-data");s.classList.add("highlight-flash"),setTimeout(()=>{s.classList.remove("highlight-flash")},1e3),this.isShowingLimitedZoomBasedData=!0,this.graphs.forEach(i=>{i.series.clear(),i.series.addArraysXY(this.timeSeries,i.limitedData),i.yAxis.setInterval(i.limitedDataMin,i.limitedDataMax),i.yAxis.setMouseInteractions(!1),i.yAxis.setChartInteractions(!1)})}else if(this.isShowingLimitedZoomBasedData&&Math.abs(t-e)<=this.maxX/3){const s=document.querySelector("#label-zoom-based-data");s.classList.add("highlight-flash"),setTimeout(()=>{s.classList.remove("highlight-flash")},1e3),this.isShowingLimitedZoomBasedData=!1,this.graphs.forEach((i,r)=>{i.series.clear(),i.series.addArraysXY(this.timeSeries,i.fullData),i.yAxis.setInterval(i.fullInterval.start,i.fullInterval.end),i.yAxis.setMouseInteractions(!1),i.yAxis.setChartInteractions(!1)})}}};var te=Object.freeze(Object.defineProperty({__proto__:null,default:_},Symbol.toStringTag,{value:"Module"}));const H=l=>class extends l{constructor(...e){super(...e);this.lastEvent=null,this.hasInitialized=!1,this.graphEvents=z()}markEvent(){this.lastEvent={timestamp:performance.now()}}registerZoomEvents(e){e.chart.onSeriesBackgroundMouseWheel((t,s)=>{let{deltaY:i}=s;const{xAxis:r,yAxis:n}=e,{start:o,end:d}=r.getInterval();i=-i;const h=this.getNewInterval(o,d,i);r.setInterval(h.start,h.end,!1,!0)})}getNewInterval(e,t,s,i=1e4){if(i<1e3)return!1;const{minX:r,maxX:n}=this,o=Math.min(n,Math.max(r,e+s*i)),d=Math.max(r,Math.min(n,t-s*i));return o*2>n?this.getNewInterval(e,t,s,i/2):{start:o,end:d}}reportRenderEvent(){requestAnimationFrame(()=>{const e=(performance.now()-this.lastEvent.timestamp)/1e3;this.hasInitialized?this.graphEvents.render({duration:e,type:T.render}):(this.hasInitialized=!0,this.graphEvents.init({duration:e,type:T.init})),this.lastEvent=null})}toggleAreaZoom(e){e?this.graphs.forEach(t=>{const{chart:s}=t;s.setMouseInteractionPan(!1),t.chartEvents={offSeriesBackgroundMouseDragStart:s.onSeriesBackgroundMouseDragStart((i,r,n)=>{n===0&&M(r.offsetX)}),offSeriesBackgroundMouseDrag:s.onSeriesBackgroundMouseDrag((i,r,n)=>{n===0&&G(r.offsetX)}),offSeriesBackgroundMouseDragStop:s.onSeriesBackgroundMouseDragStop((i,r,n)=>{if(n!==0)return;const o=D(),d=i.getSeries()[0].scale.x.getPixelSize(),u=this.mainGraph.xAxis.getInterval().start/d-this.dashboardLeftOffset;this.mainGraph.xAxis.setInterval((u+o.x)*d,(u+o.x+o.width)*d,!1,!0)})}}):this.graphs.forEach(t=>{const{chart:s}=t;for(const[i,r]of Object.entries(t.chartEvents))s[i](r),t.chartEvents[i]=null;s.setMouseInteractionPan(!0)})}};var se=Object.freeze(Object.defineProperty({__proto__:null,default:H},Symbol.toStringTag,{value:"Module"}));class X{get minX(){return this.timeSeries[0]}get maxX(){return this.timeSeries[this.timeSeries.length-1]}get mainGraph(){return this.graphs[this.graphs.length-1]}get maxVisibleCharts(){return v.channels.max}constructor(){this.graphs=[]}init(y){this.markEvent(),this.newDashboard(y),y.addEventListener("wheel",e=>{e.preventDefault()},{passive:!1})}update(y=[],e){this.hasInitialized&&this.markEvent(),e&&(this.timeSeries=e);const{graphs:t}=this,s=t.length;this.hasChannelsChanged=!1,y.forEach((i,r)=>{let n=t[r],o=r;p.length!==s&&(this.hasChannelsChanged=!0,o=s+r,t.push(this.addChannel(p[o],o)),n=t[o],this.registerZoomEvents(n)),n.series.clear(),n.series.addArraysXY(e,i.data)}),t.splice(p.length,t.length-p.length).forEach(i=>{this.hasChannelsChanged=!0,i.chart.dispose();for(let r in i)i[r]=null}),this.afterUpdate()}afterUpdate(){(!this.hasInitialized||this.hasChannelsChanged)&&(this.setXAxisStyle(),this.syncXAxesZoom()),requestAnimationFrame(()=>{(!this.hasInitialized||this.hasChannelsChanged)&&this.updateDashboardRowHeights(),this.resetView(),this.reportRenderEvent()})}}var ae=Object.freeze(Object.defineProperty({__proto__:null,default:X},Symbol.toStringTag,{value:"Module"}));class O extends _(L(H(X))){}const A=new O,Y=0,j=A.graphEvents;function N(...l){A.init(...l)}function Z(...l){A.update(...l)}function U(){}function q(){}const W=new Proxy(A,R);var ne=Object.freeze(Object.defineProperty({__proto__:null,baseDate:Y,graphEvents:j,init:N,update:Z,showLoading:U,hideLoading:q,api:W},Symbol.toStringTag,{value:"Module"}));export{Q as A,ne as L,te as a,se as b,ae as c,V as g,ee as i,K as l};
