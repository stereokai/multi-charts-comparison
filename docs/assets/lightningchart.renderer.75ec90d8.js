import{l as a}from"./vendor.d274a670.js";import{c as u,g as D,G as E}from"./echarts.renderer.f38a4c36.js";function I(n=new Date){return n.setDate(n.getDate()-1),n.setHours(22)}const _={channels:{label:"Channels",min:10,max:25,value:10},period:{label:"Sleep period (h)",min:8,max:14,value:8},samples:{label:"Samples per second",min:1,max:100,value:1},total:{label:"Total samples"},lastEvent:{label:"Last event"},extraFeatures:{toggleGrid:!0,areaZoom:!1,montages:[]}};var P=_;const A=n=>class M extends n{static addChannel(e,t,i,s){const r=e.createChartXY({columnIndex:0,rowIndex:i,columnSpan:1,rowSpan:1,disableAnimations:!0}).setTitle("").setPadding({left:100,top:0,bottom:0}).setBackgroundStrokeStyle(a.emptyLine).setMouseInteractions(!1).setMouseInteractionPan(!0).setSeriesBackgroundFillStyle(new a.SolidFill({color:a.ColorCSS("white")})),l=r.getDefaultAxisX().setMouseInteractions(!1).setTickStrategy(a.AxisTickStrategies.Empty,h=>console.log(h)).setStrokeStyle(a.emptyLine),o=r.getDefaultAxisY().setMouseInteractions(!1).setChartInteractions(!1).setStrokeStyle(a.emptyLine).setTitle(t.name).setTitleFont(new a.FontSettings({size:12})).setTitleFillStyle(new a.SolidFill({color:a.ColorHEX("#6e7079")})).setTitleRotation(0).setThickness(60).setAnimationZoom(void 0).setTickStrategy(a.AxisTickStrategies.Numeric,h=>h.setMajorTickStyle(g=>g.setLabelFillStyle(new a.SolidFill({color:a.ColorHEX("#6e7079")})).setLabelFont(new a.FontSettings({size:6})).setTickStyle(a.emptyLine)).setMinorTickStyle(g=>g.setLabelFont(new a.FontSettings({size:6})).setTickStyle(a.emptyLine))),d=r.addLineSeries({dataPattern:{pattern:"ProgressiveX",regularProgressiveStep:!0,allowDataGrouping:!0},automaticColorIndex:typeof s=="number"?s:i}).setStrokeStyle(h=>h.setThickness(-1));return{chart:r,series:d,xAxis:l,yAxis:o,row:i}}addChannel(e,t,i){return M.addChannel(this.dashboard,e,t,i)}initializeChannels(e){this.graphs.splice(0,0,...e.map((t,i)=>this.addChannel(t,i))),this.graphs.forEach(t=>this.registerZoomEvents(t))}};var Y=Object.freeze(Object.defineProperty({__proto__:null,default:A},Symbol.toStringTag,{value:"Module"})),x=`<svg id="areazoom-svg" style="position: absolute; z-index: 10000; width: 100%; height: 100%; pointer-events: none;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <!-- <rect id="resize" fill="red" x="190" y="160" width="20" height="20" /> -->
  <rect id="areazoom-rect" fill="rgba(50, 50, 50, 0.5)" />
</svg>`;let f,S;function v(n){n.insertAdjacentHTML("beforeend",x),f=document.getElementById("areazoom-rect")}function b(n){f.setAttribute("height",n)}function w(n){S=n,f.setAttribute("x",n)}function k(n){n>S?f.setAttribute("width",n-S):(f.setAttribute("width",S-n),f.setAttribute("x",n))}function C(){const n=f.getAttribute("x"),c=f.getAttribute("width");return f.setAttribute("width",0),{x:n|0,width:c|0}}var q=Object.freeze(Object.defineProperty({__proto__:null,svg:x,init:v,setHeight:b,setPosition:w,move:k,hide:C},Symbol.toStringTag,{value:"Module"})),U=Object.freeze(Object.defineProperty({__proto__:null,svg:x,init:v,setHeight:b,setPosition:w,move:k,hide:C},Symbol.toStringTag,{value:"Module"}));const T=n=>class m extends n{static visibleGridStyle=new a.SolidLine({thickness:1,fillStyle:new a.SolidFill({color:a.ColorCSS("#dfdfdf")})});static hiddenGridStyle=a.emptyLine;static getNewDashboard(e,t){return a.lightningChart({overrideInteractionMouseButtons:{chartXYPanMouseButton:0,chartXYRectangleZoomFitMouseButton:2}}).Dashboard({container:e,numberOfColumns:1,numberOfRows:t,theme:a.Themes.lightNew}).setBackgroundFillStyle(new a.SolidFill({color:a.ColorCSS("white")})).setSplitterStyle(a.emptyLine).setSplitterStyleHighlight(a.emptyLine)}newDashboard(e,t){this.dashboard=m.getNewDashboard(e,t),v(e)}updateDashboardRowHeights(){const{dashboard:e,graphs:t,pinnedGraphs:i,mainGraph:s,maxVisibleCharts:r}=this,l=t.map((p,H)=>H).filter(p=>!u[p].isHidden),o=i.map(p=>p.pinnedIndex),d=l.concat(o),h=s.xAxis.getHeight(),g=(e.engine.container.clientHeight-h)/d.length;for(let p=0;p<r;p++)d.includes(p)?e.setRowHeight(p,Math.round(g)):e.setRowHeight(p,1e-5);e.setRowHeight(s.row,Math.round(g+h)),window.dashboard=e,b(l.length*g)}setXAxisStyle(){this.graphs.forEach((e,t)=>{e.xAxis.setTickStrategy(a.AxisTickStrategies.Empty)}),this.mainGraph.xAxis.setTickStrategy(a.AxisTickStrategies.DateTime,e=>e.setDateOrigin(new Date(I())).setMajorTickStyle(t=>t.setGridStrokeStyle(a.emptyLine).setTickStyle(a.emptyLine)).setMinorTickStyle(t=>t.setGridStrokeStyle(a.emptyLine).setTickStyle(a.emptyLine)))}syncXAxesZoom(){this.axisSyncHandle&&this.axisSyncHandle.remove(),this.axisSyncHandle=a.synchronizeAxisIntervals(...this.graphs.map(e=>e.xAxis))}resetView(){const{mainGraph:e,minX:t,maxX:i}=this;e.xAxis.setInterval(t,i,!1,!0)}toggleGrid(e){this.graphs.forEach(t=>{const i=t.yAxis.getTickStrategy();t.yAxis.setTickStrategy(i,s=>s.setMajorTickStyle(r=>r.setGridStrokeStyle(e?m.visibleGridStyle:m.hiddenGridStyle)))})}toggleChannelVisibility(e,t=!1){const i=this.graphs[e];u[e].isHidden?(i.series.dispose(),i.yAxis.dispose()):(i.series.restore(),i.yAxis.restore()),t||this.updateDashboardRowHeights()}toggleChannelSticky(e,t=!1,i=NaN){const{pinnedGraphs:s,graphs:r}=this,l=r[e],o=u[e];if(o.isSticky){const d=isNaN(i)?s.length&&s[s.length-1].pinnedIndex-1||this.maxVisibleCharts-1:i,h=this.addChannel(o,d,e);h.pinnedIndex=d,s.push(h),h.series.add(l.series.kc[0].La),o.pinnedGraph=h}else{if(!o.pinnedGraph)return;const d=o.pinnedGraph;o.pinnedGraph=null,s.splice(s.indexOf(d),1).forEach(h=>{h.chart.dispose();for(let g in h)h[g]=null})}t||this.updateDashboardRowHeights()}newMontage(){return u.map((e,t)=>({channelIndex:t,isHidden:e.isHidden,isSticky:e.isSticky,pinnedGraphIndex:e.pinnedGraph&&e.pinnedGraph.pinnedIndex}))}loadMontage(e){this.pinnedGraphs.splice(0).forEach(t=>{t.chart.dispose();for(let i in t)t[i]=null}),e.forEach((t,i)=>{u[i].isHidden=t.isHidden,u[i].isSticky=t.isSticky,this.toggleChannelVisibility(i,!0),this.toggleChannelSticky(i,!0,t.pinnedGraphIndex)}),this.updateDashboardRowHeights()}};var W=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"}));const G=n=>class extends n{constructor(...e){super(...e);this.lastEvent=null,this.hasInitialized=!1,this.graphEvents=D()}markEvent(){this.lastEvent={timestamp:performance.now()}}registerZoomEvents(e){e.chart.onSeriesBackgroundMouseWheel((t,i)=>{let{deltaY:s}=i;const{xAxis:r,yAxis:l}=e,{start:o,end:d}=r.getInterval();s=-s;const h=this.getNewInterval(o,d,s);r.setInterval(h.start,h.end,!1,!0)})}getNewInterval(e,t,i,s=1e4){if(s<1e3)return!1;const{minX:r,maxX:l}=this,o=Math.min(l,Math.max(r,e+i*s)),d=Math.max(r,Math.min(l,t-i*s));return o*2>l?this.getNewInterval(e,t,i,s/2):{start:o,end:d}}reportRenderEvent(){requestAnimationFrame(()=>{const e=(performance.now()-this.lastEvent.timestamp)/1e3;this.hasInitialized?this.graphEvents.render({duration:e,type:E.render}):(this.hasInitialized=!0,this.graphEvents.init({duration:e,type:E.init})),this.lastEvent=null})}toggleAreaZoom(e){e?this.graphs.forEach(t=>{const{chart:i}=t;i.setMouseInteractionPan(!1),t.chartEvents={offSeriesBackgroundMouseDragStart:i.onSeriesBackgroundMouseDragStart((s,r,l)=>{l===0&&w(r.offsetX)}),offSeriesBackgroundMouseDrag:i.onSeriesBackgroundMouseDrag((s,r,l)=>{l===0&&k(r.offsetX)}),offSeriesBackgroundMouseDragStop:i.onSeriesBackgroundMouseDragStop((s,r,l)=>{if(l!==0)return;const o=C(),d=s.getSeries()[0].scale.x.getPixelSize(),g=this.mainGraph.xAxis.getInterval().start/d-160;this.mainGraph.xAxis.setInterval((g+o.x)*d,(g+o.x+o.width)*d,!1,!0)})}}):this.graphs.forEach(t=>{const{chart:i}=t;for(const[s,r]of Object.entries(t.chartEvents))i[s](r),t.chartEvents[s]=null;i.setMouseInteractionPan(!0)})}};var K=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"}));class L{get minX(){return this.timeSeries[0]}get maxX(){return this.timeSeries[this.timeSeries.length-1]}get mainGraph(){return this.graphs[this.graphs.length-1]}get maxVisibleCharts(){return P.channels.max}constructor(){this.graphs=[],this.pinnedGraphs=[]}init(c){this.markEvent(),this.newDashboard(c,this.maxVisibleCharts),this.initializeChannels(u),c.addEventListener("wheel",e=>{e.preventDefault()},{passive:!1})}update(c=[],e){this.hasInitialized&&this.markEvent(),e&&(this.timeSeries=e);const{graphs:t}=this,i=t.length;this.hasChannelsChanged=!1,c.forEach((s,r)=>{let l=t[r],o=r;u.length!==i&&(this.hasChannelsChanged=!0,o=i+r,t.push(this.addChannel(u[o],o)),l=t[o],this.registerZoomEvents(l)),l.series.clear(),l.series.addArraysXY(e,s.data)}),t.splice(u.length,t.length-u.length).forEach(s=>{this.hasChannelsChanged=!0,s.chart.dispose();for(let r in s)s[r]=null}),this.afterUpdate()}afterUpdate(){(!this.hasInitialized||this.hasChannelsChanged)&&(this.setXAxisStyle(),this.syncXAxesZoom()),requestAnimationFrame(()=>{(!this.hasInitialized||this.hasChannelsChanged)&&this.updateDashboardRowHeights(),this.resetView(),this.reportRenderEvent()})}}var Q=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"}));class z extends T(A(G(L))){}const y=new z,X=0,j=y.graphEvents;function F(...n){y.init(...n)}function O(...n){y.update(...n)}function B(){}function N(){}const R={get:(n,c,e)=>{if(n[c]&&typeof n[c]=="function")return n[c].bind(n);throw new Error(`API doesn't exist: ${c}`)}},V=new Proxy(y,R);var ee=Object.freeze(Object.defineProperty({__proto__:null,baseDate:X,graphEvents:j,init:F,update:O,showLoading:B,hideLoading:N,api:V},Symbol.toStringTag,{value:"Module"}));export{q as A,ee as L,P as a,W as b,K as c,Q as d,I as g,U as i,Y as l};
